<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Preload first of each set -->
  <link rel="preload" href="biogs/portrait/portrait1.webp" as="image" fetchpriority="high">
  <link rel="preload" href="biogs/landscape/landscape1.webp" as="image">
  <style>
    :root{
      --border-radius: clamp(1rem, 2vw, 2.5rem);
      --arrow-size: clamp(3rem, 8vw, 5rem);
      --vertical-gap: 0vh;
      --horizontal-gap: 0.375rem;
      --stroke: 2px; /* fixed border width */
    }
    *,*::before,*::after{ box-sizing: border-box; }
    html,body{
      margin:0; padding:0; background:transparent;
      font-family: Ubuntu, system-ui, sans-serif;
      overflow:hidden; height:100%; width:100%;
    }
    .carousel-container{
      position:relative; width:100%; height:100%;
      padding-block: var(--vertical-gap);
      display:flex; align-items:center; justify-content:center;
    }
    .carousel-track{
      display:flex; align-items:center; gap:var(--horizontal-gap);
      scroll-behavior:smooth; overflow-x:auto; -webkit-overflow-scrolling:touch;
      scrollbar-width:none; width:100%; height:calc(100% - (var(--vertical-gap)*2));
    }
    .carousel-track::-webkit-scrollbar{ display:none; }

    /* Reserve space so slides donâ€™t collapse before images load */
    .carousel-track.portrait  .carousel-image{ aspect-ratio: 3 / 4; }
    .carousel-track.landscape .carousel-image{ aspect-ratio: 4 / 3; }

    .carousel-image{
      position:relative; flex:0 0 auto; height:100%;
      border-radius: var(--border-radius);
      border: var(--stroke) solid #000;   /* real border, fixed px */
      overflow:hidden;                    /* clip inner image to rounded border */
      background:#f0f0f0;
      display:flex; cursor:pointer; font-size:16px;
    }
    .carousel-image:hover::after{
      content:""; position:absolute; inset:0; border-radius:inherit;
      background: rgba(255,255,255,0.05); pointer-events:none; z-index:1;
    }
    .carousel-image img{
      width:100%; height:100%; object-fit:contain; display:block;
      border-radius: inherit; /* ensures corners never protrude past border */
    }

    .arrow{
      position:absolute; top:50%; transform:translateY(-50%);
      background:none; border:none; cursor:pointer; padding:0; z-index:10;
      transition: transform .1s ease;
    }
    .arrow:active{ transform:translateY(-50%) scale(0.9); }
    .arrow.left{ left: var(--horizontal-gap); }
    .arrow.right{ right: var(--horizontal-gap); }
    .arrow img{ width:var(--arrow-size); height:auto; }

    .popup{
      position:fixed; inset:0; background:rgba(0,0,0,0.8);
      display:flex; align-items:center; justify-content:center;
      opacity:0; pointer-events:none; transition:opacity .3s ease; z-index:100;
    }
    .popup.visible{ opacity:1; pointer-events:auto; }
    .popup-inner{ position:relative; display:flex; align-items:center; justify-content:center; }
    .popup-inner img{
      max-width:98vw; max-height:98vh; object-fit:contain; display:block;
      background:#fff;
      border-radius: var(--border-radius);
      border: var(--stroke) solid #000;  /* same fixed border on popup */
    }

    .info-button{
      position:absolute; top:1.5rem; right:1.5rem; aspect-ratio:1/1;
      width: clamp(2rem, 3vw, 2.75rem);
      border-radius:50%;
      border: var(--stroke) solid #000;
      background:#fff; color:#000; font-family:inherit; font-weight:400;
      font-size: clamp(1.25rem, 2vw, 1.5rem); line-height:1;
      display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10;
    }
    @media (max-width:799px){
      .info-button-inline{
        position:absolute; top:6px; right:6px; width:18px; aspect-ratio:1/1;
        border-radius:50%; border:1.5px solid #000; background:#fff; color:#000;
        font-family:inherit; font-weight:400; font-size:10px; line-height:1;
        padding:0; display:flex; align-items:center; justify-content:center;
        transform: translateY(1px); cursor:pointer; z-index:10;
      }
    }
  </style>
</head>
<body>
  <div class="carousel-container">
    <button class="arrow left" id="prevBtn" aria-label="Previous image"><img src="arrows/backward-arrow.png" alt="Previous" /></button>
    <div class="carousel-track" id="track" tabindex="0" role="list"></div>
    <button class="arrow right" id="nextBtn" aria-label="Next image"><img src="arrows/forward-arrow.png" alt="Next" /></button>
  </div>

  <div class="popup" id="popup" role="dialog" aria-modal="true">
    <div class="popup-inner">
      <img id="popupImg" src="" alt="Expanded view" />
      <button id="infoBtn" class="info-button" aria-label="Open external link">i</button>
    </div>
  </div>

  <script>
    // State
    window.currentPopupLink = '#';
    let links = [];
    let isWide = window.innerWidth >= 800;
    let imagesLandscapeGlobal = [];
    let lastWidthMode = isWide ? 'wide' : 'narrow';

    // DOM
    const prevBtn  = document.getElementById('prevBtn');
    const nextBtn  = document.getElementById('nextBtn');
    const track    = document.getElementById('track');
    const popup    = document.getElementById('popup');
    const popupImg = document.getElementById('popupImg');
    const infoBtn  = document.getElementById('infoBtn');

    track.classList.add(isWide ? 'portrait' : 'landscape');

    async function fetchLinks(){
      try{
        const res = await fetch('links.txt', { cache: 'force-cache' });
        if(!res.ok) return [];
        return (await res.text()).trim().split('\n').map(line=>{
          const [index,label,url] = line.split(',').map(p=>p.trim());
          return { index:+index, label, url };
        });
      }catch{ return []; }
    }
    const gen = (pfx,n)=>Array.from({length:n},(_,i)=>`biogs/${pfx}/${pfx}${i+1}.webp`);

    function getScrollAmount(){
      const slide = track.children[0];
      if(!slide) return 100;
      const gap = parseFloat(getComputedStyle(track).gap) || 0;
      const w = slide.getBoundingClientRect().width;
      const visible = Math.max(1, Math.floor(track.clientWidth / (w + gap)));
      return visible * (w + gap);
    }
    function updateControls(){
      const maxScroll = track.scrollWidth - track.clientWidth - 1;
      prevBtn.style.display = track.scrollLeft > 0 ? 'block' : 'none';
      nextBtn.style.display = track.scrollLeft < maxScroll ? 'block' : 'none';
    }
    function openTab(url){
      const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noopener';
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function slide(src,label,linkUrl,idx,eager=false){
      const wrap=document.createElement('div');
      wrap.className='carousel-image';
      wrap.setAttribute('role','listitem');

      const img=document.createElement('img');
      img.alt=label||`Image ${idx+1}`;
      img.decoding='async';
      img.loading = eager ? 'eager' : 'lazy';
      if(eager) img.setAttribute('fetchpriority','high');
      img.src=src;

      const okLink = linkUrl && linkUrl !== '#' && linkUrl.toLowerCase() !== 'n/a';

      if(isWide){
        wrap.onclick=()=>{
          const newSrc = imagesLandscapeGlobal[idx];
          if(newSrc){ popupImg.src=newSrc; popup.classList.add('visible'); }
          window.currentPopupLink = okLink ? linkUrl : '#';
          infoBtn.style.display = okLink ? 'flex' : 'none';
        };
      }else if(okLink){
        const btn=document.createElement('button');
        btn.className='info-button-inline'; btn.textContent='i';
        btn.setAttribute('aria-label','Open external link');
        btn.onclick=e=>{ e.stopPropagation(); openTab(linkUrl); };
        wrap.appendChild(btn);
      }

      wrap.appendChild(img);
      return wrap;
    }

    async function render(){
      links = await fetchLinks();
      const n = links.length;
      if(!n){ track.innerHTML=''; updateControls(); return; }

      isWide = window.innerWidth >= 800;
      track.classList.remove('portrait','landscape');
      track.classList.add(isWide ? 'portrait' : 'landscape');

      const portraits  = gen('portrait', n);
      const landscapes = gen('landscape', n);
      imagesLandscapeGlobal = landscapes;

      const sources = isWide ? portraits : landscapes;

      track.innerHTML='';
      sources.forEach((src,i)=>{
        const {label='',url='#'} = links[i] || {};
        track.append(slide(src,label,url,i,i<4)); // first 4 eager
      });

      requestAnimationFrame(updateControls);
    }

    prevBtn.onclick = ()=>track.scrollBy({left:-getScrollAmount(), behavior:'smooth'});
    nextBtn.onclick = ()=>track.scrollBy({left: getScrollAmount(), behavior:'smooth'});
    track.addEventListener('scroll', updateControls);

    window.addEventListener('resize', ()=>{
      const now = window.innerWidth >= 800 ? 'wide' : 'narrow';
      if(now !== lastWidthMode){ lastWidthMode = now; render(); }
    });

    popup.onclick = e=>{ if(e.target===popup) popup.classList.remove('visible'); };
    infoBtn.onclick = e=>{
      e.stopPropagation();
      if(window.currentPopupLink && window.currentPopupLink !== '#' && window.currentPopupLink.toLowerCase() !== 'n/a'){
        openTab(window.currentPopupLink);
      }
    };

    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>
