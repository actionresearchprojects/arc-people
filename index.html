<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: Ubuntu, sans-serif;
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    .carousel-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .carousel-track {
      display: flex;
      transition: transform 0.3s ease;
      height: 100%;
      scroll-behavior: smooth;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .carousel-track::-webkit-scrollbar {
      display: none;
    }
    .carousel-image {
      position: relative;
      flex: 0 0 auto;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-right: 4px;
    }
    .carousel-image img {
      max-height: 100%;
      max-width: 100%;
      object-fit: contain;
      border-radius: 12px;
      display: none;
    }
    .carousel-image.loaded img {
      display: block;
    }
    .corner-tag {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 52px;
      height: 52px;
      background: linear-gradient(to bottom, #fae64d, #f5c63d);
      border-bottom-right-radius: 14px;
      clip-path: polygon(100% 0, 0% 100%, 100% 100%);
      cursor: pointer;
      z-index: 20;
      display: flex;
      align-items: flex-end;
      justify-content: flex-end;
      padding: 6px;
      font-weight: bold;
      color: black;
    }
    .corner-tag span {
      margin-bottom: 2px;
      margin-right: 2px;
      font-size: 24px;
      font-family: Ubuntu, sans-serif;
    }
    .carousel-image.loaded .corner-tag {
      display: flex;
    }
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%) scale(1);
      z-index: 10;
      cursor: pointer;
      transition: transform 0.1s ease;
    }
    .arrow:active {
      transform: translateY(-50%) scale(0.9);
    }
    .arrow.left { left: 10px; }
    .arrow.right { right: 10px; }
    .arrow img {
      width: clamp(80px, 10vw, 120px);
      height: auto;
    }
    .dots-wrapper {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 16px;
      background: rgba(0, 0, 0, 0.15);
      border-radius: 20px;
      backdrop-filter: blur(6px);
      z-index: 1001;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .dots {
      display: flex;
      gap: 10px;
    }
    .dot {
      width: 14px;
      height: 14px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      box-shadow: none;
    }
    .dot.active {
      background: #ffffff;
      box-shadow: none;
    }
    .popup {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    .popup.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .popup img {
      max-width: 90%;
      max-height: 90%;
    }
    .popup .close {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 36px;
      color: white;
      cursor: pointer;
    }
    .carousel-image:hover:not(:has(.corner-tag:hover))::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div class="carousel-container">
    <div class="arrow left" id="prevBtn"><img src="arrows/backward-arrow.png" alt="Previous" /></div>
    <div class="carousel-track" id="track"></div>
    <div class="arrow right" id="nextBtn"><img src="arrows/forward-arrow.png" alt="Next" /></div>
    <div class="dots-wrapper"><div class="dots" id="dots"></div></div>
  </div>
  <div class="popup" id="popup">
    <span class="close" id="popupClose">&times;</span>
    <img id="popupImg" src="" alt="Expanded" />
  </div>
  <script>
    async function fetchLinks() {
      if (window.location.protocol === 'file:') return [];
      try {
        const res = await fetch('links.txt');
        const data = await res.text();
        return data.trim().split("\n").map(line => {
          const [index, label, url] = line.split(',').map(part => part.trim());
          return { index: parseInt(index), label, url };
        });
      } catch (e) {
        console.warn("Link file missing or unreadable.");
        return [];
      }
    }

    function generateImageList(prefix, count) {
      return Array.from({ length: count }, (_, i) => `biogs/${prefix}/${prefix}${i + 1}.png`);
    }

    const imagesPortrait = generateImageList("portrait", 10);
    const imagesLandscape = generateImageList("landscape", 10);

    const isPortraitMode = () => window.innerWidth >= 1000;
    const track = document.getElementById("track");
    const dots = document.getElementById("dots");
    const popup = document.getElementById("popup");
    const popupImg = document.getElementById("popupImg");
    const popupClose = document.getElementById("popupClose");
    let currentIndex = 0;
    let images = [];
    let links = [];

    async function renderCarousel() {
      links = await fetchLinks();
      images = isPortraitMode() ? imagesPortrait : imagesLandscape;
      track.innerHTML = "";
      dots.innerHTML = "";
      let validCount = 0;

      for (let i = 0; i < images.length; i++) {
        const src = images[i];
        const img = new Image();
        img.src = src;
        await new Promise(res => {
          img.onload = () => res(true);
          img.onerror = () => res(false);
        });
        if (!img.complete || img.naturalWidth === 0) continue;

        const div = document.createElement("div");
        div.className = "carousel-image loaded";
        const linkEntry = links.find(l => l.index === i + 1);
        const link = linkEntry?.url || "#";

        img.onclick = () => window.open(link, "_blank");

        const tag = document.createElement("div");
        tag.className = "corner-tag";
        const plus = document.createElement("span");
        plus.textContent = "+";
        tag.appendChild(plus);
        tag.onclick = (e) => {
          e.stopPropagation();
          popupImg.src = src;
          popup.classList.add("visible");
        };

        div.appendChild(img);
        div.appendChild(tag);
        track.appendChild(div);

        const dot = document.createElement("div");
        dot.className = "dot";
        if (validCount === 0) dot.classList.add("active");
        dots.appendChild(dot);
        validCount++;
      }

      updateCarousel();
    }

    function updateCarousel() {
      const width = document.querySelector(".carousel-image")?.offsetWidth || 0;
      track.scrollTo({ left: width * currentIndex, behavior: 'smooth' });
      dots.childNodes.forEach((dot, i) => dot.classList.toggle("active", i === currentIndex));
      document.getElementById("prevBtn").style.display = currentIndex === 0 ? "none" : "block";
      document.getElementById("nextBtn").style.display = currentIndex >= dots.childNodes.length - 1 ? "none" : "block";
    }

    document.getElementById("prevBtn").onclick = () => {
      if (currentIndex > 0) { currentIndex--; updateCarousel(); }
    };

    document.getElementById("nextBtn").onclick = () => {
      if (currentIndex < dots.childNodes.length - 1) { currentIndex++; updateCarousel(); }
    };

    popupClose.onclick = () => popup.classList.remove("visible");
    popup.onclick = (e) => { if (e.target === popup) popup.classList.remove("visible"); };
    window.addEventListener("resize", renderCarousel);

    let startX = 0;
    track.addEventListener("touchstart", (e) => { startX = e.touches[0].clientX; });
    track.addEventListener("touchend", (e) => {
      const diff = e.changedTouches[0].clientX - startX;
      if (diff > 50 && currentIndex > 0) currentIndex--;
      else if (diff < -50 && currentIndex < dots.childNodes.length - 1) currentIndex++;
      updateCarousel();
    });

    renderCarousel();
  </script>
</body>
</html>
