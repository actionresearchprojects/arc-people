<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Preload for quicker visual start -->
  <link rel="preload" href="biogs/portrait/portrait1.webp" as="image">
  <link rel="preload" href="biogs/portrait/portrait2.webp" as="image">
  <link rel="preload" href="biogs/landscape/landscape1.webp" as="image">
  <link rel="preload" href="biogs/landscape/landscape2.webp" as="image">

  <style>
    :root {
      --border-radius: 2rem;
      --arrow-size: clamp(3rem, 8vw, 5rem);
      --vertical-gap: 0vh;
      --horizontal-gap: 0.375rem;
    }
    *, *::before, *::after { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: Ubuntu, sans-serif;
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    .carousel-container {
      position: relative;
      width: 100%;
      height: 100%;
      padding-top: var(--vertical-gap);
      padding-bottom: var(--vertical-gap);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-track {
      display: flex;
      align-items: center;
      gap: var(--horizontal-gap);
      scroll-behavior: smooth;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      width: 100%;
      height: calc(100% - (var(--vertical-gap) * 2));
    }
    .carousel-track::-webkit-scrollbar { display: none; }
    .carousel-image {
      position: relative;
      flex: 0 0 auto;
      border-radius: var(--border-radius);
      border: 0.1875rem solid #000;
      overflow: hidden;
      background: #f0f0f0;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      cursor: pointer;
    }
    .carousel-image:hover::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.05);
      border-radius: var(--border-radius);
      z-index: 1;
      pointer-events: none;
    }
    .carousel-image img {
      display: block;
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      z-index: 10;
      transition: transform 0.1s ease;
    }
    .arrow:active { transform: translateY(-50%) scale(0.9); }
    .arrow.left { left: var(--horizontal-gap); }
    .arrow.right { right: var(--horizontal-gap); }
    .arrow img { width: var(--arrow-size); height: auto; }
    .popup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 100;
    }
    .popup.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .popup img {
      max-width: 98vw;
      max-height: 98vh;
      object-fit: contain;
      border: 0.375rem solid #000;
      border-radius: var(--border-radius);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="carousel-container">
    <button class="arrow left" id="prevBtn" aria-label="Previous image"><img src="arrows/backward-arrow.png" alt="Previous" /></button>
    <div class="carousel-track" id="track" tabindex="0" role="list"></div>
    <button class="arrow right" id="nextBtn" aria-label="Next image"><img src="arrows/forward-arrow.png" alt="Next" /></button>
  </div>
  <div class="popup" id="popup" role="dialog" aria-modal="true">
    <img id="popupImg" src="" alt="Expanded view" />
  </div>
  <script>
    window.currentPopupLink = '#';

    async function fetchLinks() {
      try {
        const res = await fetch('links.txt');
        if (!res.ok) return [];
        return (await res.text()).trim().split('\n').map(line => {
          const [index, label, url] = line.split(',').map(p => p.trim());
          return { index: +index, label, url };
        });
      } catch {
        return [];
      }
    }

    function generateImages(prefix, count) {
      return Array.from({ length: count }, (_, i) => `biogs/${prefix}/${prefix}${i+1}.webp`);
    }

    const imagesPortrait = generateImages('portrait', 10);
    const imagesLandscape = generateImages('landscape', 10);
    let links = [];
    let currentIndex = 0;
    let isWide = window.innerWidth >= 800;

    function createImageSlide(src, label, linkUrl, idx) {
      const container = document.createElement('div');
      container.className = 'carousel-image';
      container.setAttribute('role', 'listitem');

      const img = document.createElement('img');
      img.src = src;
      img.alt = label || `Image ${idx+1}`;

      if (isWide) {
        container.onclick = () => {
          document.getElementById('popupImg').src = imagesLandscape[idx];
          popup.classList.add('visible');
          window.currentPopupLink = linkUrl || '#';
        };
      }

      container.append(img);
      return container;
    }

    async function renderCarousel() {
      links = await fetchLinks();
      isWide = window.innerWidth >= 800;
      const sources = isWide ? imagesPortrait : imagesLandscape;

      const loaded = (await Promise.all(sources.map((src,i) => new Promise(r=>{
        const t=new Image(); t.onload=()=>r({src,i}); t.onerror=()=>r(null); t.src=src;
      })))).filter(Boolean);

      track.innerHTML = '';
      loaded.forEach(({src,i})=>{
        const entry = links.find(l => l.index === i+1) || {};
        track.append(createImageSlide(src, entry.label, entry.url || '#', i));
      });

      updateControls(loaded.length);
      scrollToIndex();
    }

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const track   = document.getElementById('track');
    const popup   = document.getElementById('popup');
    const popupImg = document.getElementById('popupImg');

    function updateControls(count) {
      prevBtn.style.display = currentIndex === 0 ? 'none' : 'block';
      nextBtn.style.display = currentIndex >= count - 1 ? 'none' : 'block';
    }

    function scrollToIndex() {
      const slide = track.children[currentIndex];
      if (!slide) return;
      track.scrollTo({ left: slide.offsetLeft, behavior: 'smooth' });
      updateControls(track.children.length);
    }

    prevBtn.onclick = () => {
      if (currentIndex > 0) currentIndex--, scrollToIndex();
    };
    nextBtn.onclick = () => {
      if (currentIndex < track.children.length - 1) currentIndex++, scrollToIndex();
    };

    popup.onclick = e => {
      if (e.target === popupImg) {
        if (isWide && window.currentPopupLink && window.currentPopupLink !== '#') {
          const a = document.createElement('a');
          a.href = window.currentPopupLink;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        }
        popup.classList.remove('visible');
      } else if (e.target === popup) {
        popup.classList.remove('visible');
      }
    };

    window.addEventListener('resize', renderCarousel);
    document.addEventListener('DOMContentLoaded', renderCarousel);
  </script>
</body>
</html>
